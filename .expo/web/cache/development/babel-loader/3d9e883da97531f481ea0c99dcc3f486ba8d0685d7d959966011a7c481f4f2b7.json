{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nvar BASE_URL = 'https://s5-4242.nuage-peda.fr/gsbvttMobile/API';\nvar formatTime = function formatTime(time) {\n  if (time.split(':').length === 3) return time;\n  return time + ':00';\n};\nexport var login = function () {\n  var _ref = _asyncToGenerator(function* (email, password) {\n    try {\n      var response = yield fetch(`${BASE_URL}/ApiAuth.php`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          email: email,\n          password: password\n        })\n      });\n      var data = yield response.json();\n      if (!response.ok) {\n        throw new Error(data.message || 'Erreur de connexion');\n      }\n      return data;\n    } catch (error) {\n      console.error('Login error:', error);\n      throw error;\n    }\n  });\n  return function login(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar fetchWithAuth = function () {\n  var _ref2 = _asyncToGenerator(function* (endpoint) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    try {\n      var token = yield AsyncStorage.getItem('userToken');\n      if (!token) {\n        throw new Error('Token non trouvé');\n      }\n      var response = yield fetch(`${BASE_URL}${endpoint}`, _objectSpread(_objectSpread({}, options), {}, {\n        headers: _objectSpread(_objectSpread({}, options.headers), {}, {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        })\n      }));\n      var data = yield response.json();\n      if (!response.ok) {\n        throw new Error(data.message || 'Erreur API');\n      }\n      return data;\n    } catch (error) {\n      console.error('API error:', error);\n      throw error;\n    }\n  });\n  return function fetchWithAuth(_x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var fetchVisites = function () {\n  var _ref3 = _asyncToGenerator(function* () {\n    return fetchWithAuth('/ApiVisite.php');\n  });\n  return function fetchVisites() {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var createVisite = function () {\n  var _ref4 = _asyncToGenerator(function* (visiteData) {\n    try {\n      var formattedData = _objectSpread(_objectSpread({}, visiteData), {}, {\n        heure_arrivee: formatTime(visiteData.heure_arrivee),\n        heure_debut_entretien: formatTime(visiteData.heure_debut_entretien),\n        heure_depart: formatTime(visiteData.heure_depart)\n      });\n      var heureArrivee = new Date(`2000-01-01T${formattedData.heure_arrivee}`);\n      var heureDebut = new Date(`2000-01-01T${formattedData.heure_debut_entretien}`);\n      var heureDepart = new Date(`2000-01-01T${formattedData.heure_depart}`);\n      var tempsAttente = Math.round((heureDebut.getTime() - heureArrivee.getTime()) / 1000 / 60);\n      var tempsVisite = Math.round((heureDepart.getTime() - heureArrivee.getTime()) / 1000 / 60);\n      var completeVisiteData = _objectSpread(_objectSpread({}, formattedData), {}, {\n        temps_attente: tempsAttente,\n        temps_visite: tempsVisite\n      });\n      console.log('Données envoyées à l\\'API:', completeVisiteData);\n      var response = yield fetchWithAuth('/ApiVisite.php', {\n        method: 'POST',\n        body: JSON.stringify(completeVisiteData)\n      });\n      console.log('Réponse de l\\'API:', response);\n      return response;\n    } catch (error) {\n      console.error('Erreur lors de la création de la visite:', error);\n      throw error;\n    }\n  });\n  return function createVisite(_x4) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport var fetchCabinets = function () {\n  var _ref5 = _asyncToGenerator(function* (latitude, longitude) {\n    var params = latitude && longitude ? `?latitude=${latitude}&longitude=${longitude}` : '';\n    return fetchWithAuth(`/ApiCabinet.php${params}`);\n  });\n  return function fetchCabinets(_x5, _x6) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nexport var fetchMedecins = function () {\n  var _ref6 = _asyncToGenerator(function* () {\n    return fetchWithAuth('/ApiMedecin.php');\n  });\n  return function fetchMedecins() {\n    return _ref6.apply(this, arguments);\n  };\n}();\nexport var getVisite = function () {\n  var _ref7 = _asyncToGenerator(function* (id) {\n    return fetchWithAuth(`/ApiVisite.php?id=${id}`);\n  });\n  return function getVisite(_x7) {\n    return _ref7.apply(this, arguments);\n  };\n}();\nexport var updateVisite = function () {\n  var _ref8 = _asyncToGenerator(function* (visiteData) {\n    return fetchWithAuth('/ApiVisite.php', {\n      method: 'PUT',\n      body: JSON.stringify(visiteData)\n    });\n  });\n  return function updateVisite(_x8) {\n    return _ref8.apply(this, arguments);\n  };\n}();\nexport var deleteVisite = function () {\n  var _ref9 = _asyncToGenerator(function* (id) {\n    return fetchWithAuth(`/ApiVisite.php`, {\n      method: 'DELETE',\n      body: JSON.stringify({\n        id_visite: id\n      })\n    });\n  });\n  return function deleteVisite(_x9) {\n    return _ref9.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["AsyncStorage","BASE_URL","formatTime","time","split","length","login","_ref","_asyncToGenerator","email","password","response","fetch","method","headers","body","JSON","stringify","data","json","ok","Error","message","error","console","_x","_x2","apply","arguments","fetchWithAuth","_ref2","endpoint","options","undefined","token","getItem","_objectSpread","_x3","fetchVisites","_ref3","createVisite","_ref4","visiteData","formattedData","heure_arrivee","heure_debut_entretien","heure_depart","heureArrivee","Date","heureDebut","heureDepart","tempsAttente","Math","round","getTime","tempsVisite","completeVisiteData","temps_attente","temps_visite","log","_x4","fetchCabinets","_ref5","latitude","longitude","params","_x5","_x6","fetchMedecins","_ref6","getVisite","_ref7","id","_x7","updateVisite","_ref8","_x8","deleteVisite","_ref9","id_visite","_x9"],"sources":["D:/BTS/AP/GSBVTTMobile/src/services/api.ts"],"sourcesContent":["import AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nconst BASE_URL = 'https://s5-4242.nuage-peda.fr/gsbvttMobile/API';\r\n\r\ninterface LoginResponse {\r\n  status: string;\r\n  message: string;\r\n  user: {\r\n    id: number;\r\n    nom: string;\r\n    prenom: string;\r\n    email: string;\r\n  };\r\n  token: string;\r\n}\r\n\r\ninterface ApiError {\r\n  error: string;\r\n  message?: string;\r\n}\r\n\r\n// Ajout des interfaces pour les visites\r\ninterface VisiteDetails {\r\n  id_visite: number;\r\n  date_visite: string;\r\n  heure_arrivee: string;\r\n  heure_debut_entretien: string;\r\n  heure_depart: string;\r\n  rendez_vous: boolean;\r\n  id_medecin: number;\r\n  id_visiteur: number;\r\n}\r\n\r\ninterface CreateVisiteData {\r\n  id_visiteur: number;\r\n  id_medecin: number;\r\n  date_visite: string;\r\n  heure_arrivee: string;\r\n  heure_debut_entretien: string;\r\n  heure_depart: string;\r\n  rendez_vous: boolean;\r\n  temps_attente?: number;\r\n  temps_visite?: number;\r\n}\r\n\r\nconst formatTime = (time: string): string => {\r\n  // Si l'heure contient déjà les secondes, on la renvoie telle quelle\r\n  if (time.split(':').length === 3) return time;\r\n  // Sinon on ajoute les secondes\r\n  return time + ':00';\r\n};\r\n\r\nexport const login = async (email: string, password: string): Promise<LoginResponse> => {\r\n  try {\r\n    const response = await fetch(`${BASE_URL}/ApiAuth.php`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ email, password }),\r\n    });\r\n\r\n    const data = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(data.message || 'Erreur de connexion');\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Login error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst fetchWithAuth = async (endpoint: string, options: RequestInit = {}) => {\r\n  try {\r\n    const token = await AsyncStorage.getItem('userToken');\r\n    \r\n    if (!token) {\r\n      throw new Error('Token non trouvé');\r\n    }\r\n\r\n    const response = await fetch(`${BASE_URL}${endpoint}`, {\r\n      ...options,\r\n      headers: {\r\n        ...options.headers,\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    const data = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(data.message || 'Erreur API');\r\n    }\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error('API error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const fetchVisites = async () => {\r\n  return fetchWithAuth('/ApiVisite.php');\r\n};\r\n\r\nexport const createVisite = async (visiteData: CreateVisiteData) => {\r\n  try {\r\n    // Formater les heures\r\n    const formattedData = {\r\n      ...visiteData,\r\n      // Conversion des heures au format attendu par l'API\r\n      heure_arrivee: formatTime(visiteData.heure_arrivee),\r\n      heure_debut_entretien: formatTime(visiteData.heure_debut_entretien),\r\n      heure_depart: formatTime(visiteData.heure_depart),\r\n    };\r\n\r\n    // Calculer les temps d'attente et de visite\r\n    const heureArrivee = new Date(`2000-01-01T${formattedData.heure_arrivee}`);\r\n    const heureDebut = new Date(`2000-01-01T${formattedData.heure_debut_entretien}`);\r\n    const heureDepart = new Date(`2000-01-01T${formattedData.heure_depart}`);\r\n\r\n    const tempsAttente = Math.round((heureDebut.getTime() - heureArrivee.getTime()) / 1000 / 60);\r\n    const tempsVisite = Math.round((heureDepart.getTime() - heureArrivee.getTime()) / 1000 / 60);\r\n\r\n    const completeVisiteData = {\r\n      ...formattedData,\r\n      temps_attente: tempsAttente,\r\n      temps_visite: tempsVisite\r\n    };\r\n\r\n    console.log('Données envoyées à l\\'API:', completeVisiteData); // Pour débugger\r\n\r\n    const response = await fetchWithAuth('/ApiVisite.php', {\r\n      method: 'POST',\r\n      body: JSON.stringify(completeVisiteData),\r\n    });\r\n\r\n    console.log('Réponse de l\\'API:', response); // Pour débugger\r\n    return response;\r\n  } catch (error) {\r\n    console.error('Erreur lors de la création de la visite:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const fetchCabinets = async (latitude?: number, longitude?: number) => {\r\n  const params = latitude && longitude ? `?latitude=${latitude}&longitude=${longitude}` : '';\r\n  return fetchWithAuth(`/ApiCabinet.php${params}`);\r\n};\r\n\r\nexport const fetchMedecins = async () => {\r\n  return fetchWithAuth('/ApiMedecin.php');\r\n};\r\n\r\nexport const getVisite = async (id: number): Promise<VisiteDetails> => {\r\n  return fetchWithAuth(`/ApiVisite.php?id=${id}`);\r\n};\r\n\r\nexport const updateVisite = async (visiteData: VisiteDetails) => {\r\n  return fetchWithAuth('/ApiVisite.php', {\r\n    method: 'PUT',\r\n    body: JSON.stringify(visiteData)\r\n  });\r\n};\r\n\r\nexport const deleteVisite = async (id: number) => {\r\n  return fetchWithAuth(`/ApiVisite.php`, {\r\n    method: 'DELETE',\r\n    body: JSON.stringify({ id_visite: id }),\r\n  });\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}